#include <pto/pto-inst.hpp>
#include <pto/common/constants.hpp>
#include "acl/acl.h"

#include "pto/pto-inst.hpp"
using namespace pto;
__global__ AICORE void gqa_softmax_block(__gm__ float* v1, __gm__ float* v2, __gm__ float* v3) {
  unsigned v4 = 1;
  unsigned v5 = 0;
  float v6 = 0.0416666716f;
  float v7 = 0.166666701f;
  float v8 = 0.5f;
  float v9 = 32.0000992f;
  float v10 = 1.00010002f;
  float v11 = 4.00010014f;
  float v12 = -4.00010014f;
  float v13 = 0.176776707f;
  int32_t v14 = 32;
  int32_t v15 = 1;
  int64_t v16 = 0;
  int64_t v17 = 4096;
  int64_t v18 = 20480;
  int64_t v19 = 8192;
  int64_t v20 = 12288;
  int64_t v21 = 16384;
  using T = float;
  unsigned v22 = (unsigned) v14;
  unsigned v23 = v5 * v22;
  unsigned v24 = v5 + v23;
  unsigned v25 = (unsigned) v15;
  unsigned v26 = v5 * v25;
  unsigned v27 = v24 + v26;
  __gm__ float* v28 = v1 + v27;
  using GTShape_607021680 = pto::Shape<1, 1, 1, 32, 32>;
  using GTStride_607021680 = pto::Stride<1024, 1024, 1024, 32, 1>;
  constexpr pto::Layout GT_607021680_layout = pto::Layout::ND;
  GTShape_607021680 v29 = GTShape_607021680();
  GTStride_607021680 v30 = GTStride_607021680();
  using GT_607021680 = GlobalTensor<float, GTShape_607021680, GTStride_607021680, GT_607021680_layout>;
  GT_607021680 v31 = GT_607021680(v28, v29, v30);
  unsigned v32 = (unsigned) v14;
  unsigned v33 = v5 * v32;
  unsigned v34 = v5 + v33;
  unsigned v35 = (unsigned) v15;
  unsigned v36 = v5 * v35;
  unsigned v37 = v34 + v36;
  __gm__ float* v38 = v2 + v37;
  using GTShape_607021856 = pto::Shape<1, 1, 1, 32, 32>;
  using GTStride_607021856 = pto::Stride<1024, 1024, 1024, 32, 1>;
  constexpr pto::Layout GT_607021856_layout = pto::Layout::ND;
  GTShape_607021856 v39 = GTShape_607021856();
  GTStride_607021856 v40 = GTStride_607021856();
  using GT_607021856 = GlobalTensor<float, GTShape_607021856, GTStride_607021856, GT_607021856_layout>;
  GT_607021856 v41 = GT_607021856(v38, v39, v40);
  unsigned v42 = (unsigned) v14;
  unsigned v43 = v5 * v42;
  unsigned v44 = v5 + v43;
  unsigned v45 = (unsigned) v15;
  unsigned v46 = v5 * v45;
  unsigned v47 = v44 + v46;
  __gm__ float* v48 = v3 + v47;
  using GTShape_607022032 = pto::Shape<1, 1, 1, 32, 32>;
  using GTStride_607022032 = pto::Stride<1024, 1024, 1024, 32, 1>;
  constexpr pto::Layout GT_607022032_layout = pto::Layout::ND;
  GTShape_607022032 v49 = GTShape_607022032();
  GTStride_607022032 v50 = GTStride_607022032();
  using GT_607022032 = GlobalTensor<float, GTShape_607022032, GTStride_607022032, GT_607022032_layout>;
  GT_607022032 v51 = GT_607022032(v48, v49, v50);
  Tile<TileType::Vec, float, 32, 32, BLayout::RowMajor, 32, 32, SLayout::NoneBox, 512, PadValue::Null> v52;
  TASSIGN(v52, v16);
  Tile<TileType::Vec, float, 32, 32, BLayout::RowMajor, 32, 32, SLayout::NoneBox, 512, PadValue::Null> v53;
  TASSIGN(v53, v17);
  Tile<TileType::Vec, float, 32, 32, BLayout::RowMajor, 32, 32, SLayout::NoneBox, 512, PadValue::Null> v54;
  TASSIGN(v54, v18);
  Tile<TileType::Vec, float, 32, 32, BLayout::RowMajor, 32, 32, SLayout::NoneBox, 512, PadValue::Null> v55;
  TASSIGN(v55, v19);
  Tile<TileType::Vec, float, 32, 32, BLayout::RowMajor, 32, 32, SLayout::NoneBox, 512, PadValue::Null> v56;
  TASSIGN(v56, v20);
  Tile<TileType::Vec, float, 32, 32, BLayout::RowMajor, 32, 32, SLayout::NoneBox, 512, PadValue::Null> v57;
  TASSIGN(v57, v21);
  TLOAD(v52, v31);
  set_flag(PIPE_MTE2, PIPE_V, EVENT_ID0);
  TLOAD(v53, v41);
  TMUL(v52, v52, v53);
  TMULS(v52, v52, v13);
  TMAXS(v52, v52, v12);
  TMINS(v52, v52, v11);
  TMUL(v55, v52, v52);
  TMUL(v56, v55, v52);
  TMUL(v57, v56, v52);
  TMULS(v55, v55, v8);
  TMULS(v56, v56, v7);
  TMULS(v57, v57, v6);
  wait_flag(PIPE_MTE2, PIPE_V, EVENT_ID0);
  TADD(v54, v52, v55);
  TADD(v54, v54, v56);
  TADD(v54, v54, v57);
  set_flag(PIPE_V, PIPE_MTE3, EVENT_ID0);
  TADDS(v54, v54, v10);
  TDIVS(v54, v54, v9);
  wait_flag(PIPE_V, PIPE_MTE3, EVENT_ID0);
  TSTORE(v51, v54);
  pipe_barrier(PIPE_ALL);
  return;
}


