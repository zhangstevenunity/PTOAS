// Generated by docs/bytecode/tools/gen_v0_tables.py
#pragma once

#include <cstdint>
#include <optional>

#include <llvm/ADT/StringRef.h>
#include <llvm/ADT/StringSwitch.h>

namespace ptobc::v0 {

struct OpInfo {
  uint16_t opcode;
  const char *name;
  uint8_t has_variant_u8;
  uint8_t result_type_mode;
  uint8_t operand_mode;
  uint16_t num_operands;
  uint16_t num_results;
  uint16_t num_regions;
  uint8_t imm_kind;
};

inline constexpr OpInfo kOpTable[] = {
  {0x0000, "pto.get_block_idx", 0, 0x01, 0x00, 0, 1, 0, 0x00},
  {0x0001, "pto.get_block_num", 0, 0x01, 0x00, 0, 1, 0, 0x00},
  {0x0002, "pto.get_subblock_idx", 0, 0x01, 0x00, 0, 1, 0, 0x00},
  {0x0003, "pto.get_subblock_num", 0, 0x01, 0x00, 0, 1, 0, 0x00},
  {0x0004, "pto.make_tensor_view", 0, 0x01, 0x03, 1, 1, 0, 0x06},
  {0x0005, "pto.partition_view", 0, 0x01, 0x03, 1, 1, 0, 0x07},
  {0x0006, "pto.section", 1, 0x00, 0x00, 0, 0, 1, 0x00},
  {0x1000, "pto.addptr", 0, 0x01, 0x00, 2, 1, 0, 0x00},
  {0x1001, "pto.alloc_tile", 0, 0x01, 0x04, 0, 1, 0, 0x08},
  {0x1002, "pto.barrier", 0, 0x00, 0x00, 0, 0, 0, 0x00},
  {0x1003, "pto.mgather", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1004, "pto.mscatter", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1005, "pto.record_event", 0, 0x00, 0x00, 0, 0, 0, 0x02},
  {0x1006, "pto.tabs", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1007, "pto.tadd", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1008, "pto.taddc", 0, 0x00, 0x00, 4, 0, 0, 0x00},
  {0x1009, "pto.tadds", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x100A, "pto.taddsc", 0, 0x00, 0x00, 4, 0, 0, 0x00},
  {0x100B, "pto.tand", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x100C, "pto.tands", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x100D, "pto.tci", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x100E, "pto.tcmp", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x100F, "pto.tcmps", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1010, "pto.tcolexpand", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1011, "pto.tcolexpandadd", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1012, "pto.tcolexpanddiv", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1013, "pto.tcolexpandexpdif", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1014, "pto.tcolexpandmax", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1015, "pto.tcolexpandmin", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1016, "pto.tcolexpandmul", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1017, "pto.tcolexpandsub", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1018, "pto.tcolmax", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1019, "pto.tcolmin", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x101A, "pto.tcolprod", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x101B, "pto.tcolsum", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x101C, "pto.tcvt", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x101D, "pto.tdiv", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x101E, "pto.tdivs", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x101F, "pto.texp", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1020, "pto.texpands", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1021, "pto.textract", 0, 0x00, 0x00, 4, 0, 0, 0x00},
  {0x1022, "pto.textract_fp", 0, 0x00, 0x00, 4, 0, 0, 0x00},
  {0x1023, "pto.tfillpad", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1024, "pto.tfillpad_expand", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1025, "pto.tfillpad_inplace", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1026, "pto.tfmod", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1027, "pto.tfmods", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1028, "pto.tgather", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1029, "pto.tgatherb", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x102A, "pto.tgemv", 1, 0x00, 0x01, 0, 0, 0, 0x00},
  {0x102B, "pto.tgetval", 0, 0x00, 0x00, 0, 0, 0, 0x00},
  {0x102C, "pto.timg2col", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x102D, "pto.tinsert", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x102E, "pto.tinsert_fp", 0, 0x00, 0x00, 5, 0, 0, 0x00},
  {0x102F, "pto.tload", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1030, "pto.tlog", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1031, "pto.tlrelu", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1032, "pto.tmatmul", 1, 0x00, 0x01, 0, 0, 0, 0x00},
  {0x1033, "pto.tmatmul.mx", 1, 0x00, 0x01, 0, 0, 0, 0x00},
  {0x1034, "pto.tmax", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1035, "pto.tmaxs", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1036, "pto.tmin", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1037, "pto.tmins", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1038, "pto.tmov", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1039, "pto.tmov.fp", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x103A, "pto.tmrgsort", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x103B, "pto.tmul", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x103C, "pto.tmuls", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x103D, "pto.tneg", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x103E, "pto.tnot", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x103F, "pto.tor", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1040, "pto.tors", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1041, "pto.tpartadd", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1042, "pto.tpartmax", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1043, "pto.tpartmin", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1044, "pto.tpartmul", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1045, "pto.tprefetch", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1046, "pto.tprelu", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1047, "pto.tquant", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1048, "pto.trecip", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1049, "pto.trelu", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x104A, "pto.trem", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x104B, "pto.trems", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x104C, "pto.treshape", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x104D, "pto.trowexpand", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x104E, "pto.trowexpandadd", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x104F, "pto.trowexpandexpdif", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1050, "pto.trowexpandmax", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1051, "pto.trowexpandmin", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1052, "pto.trowmax", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1053, "pto.trowmin", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1054, "pto.trowsum", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1055, "pto.trsqrt", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1056, "pto.tscatter", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1057, "pto.tsel", 0, 0x00, 0x00, 4, 0, 0, 0x00},
  {0x1058, "pto.tsels", 0, 0x00, 0x00, 4, 0, 0, 0x00},
  {0x1059, "pto.tset_img2col_padding", 0, 0x00, 0x00, 1, 0, 0, 0x00},
  {0x105A, "pto.tset_img2col_rpt", 0, 0x00, 0x00, 1, 0, 0, 0x00},
  {0x105B, "pto.tsetfmatrix", 0, 0x00, 0x00, 1, 0, 0, 0x00},
  {0x105C, "pto.tsethf32mode", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x105D, "pto.tsettf32mode", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x105E, "pto.tsetval", 0, 0x00, 0x00, 0, 0, 0, 0x00},
  {0x105F, "pto.tshl", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1060, "pto.tshls", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1061, "pto.tshr", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1062, "pto.tshrs", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1063, "pto.tsort32", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1064, "pto.tsqrt", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1065, "pto.tstore", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x1066, "pto.tstore.fp", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1067, "pto.tsub", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1068, "pto.tsubc", 0, 0x00, 0x00, 4, 0, 0, 0x00},
  {0x1069, "pto.tsubs", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x106A, "pto.tsubsc", 0, 0x00, 0x00, 4, 0, 0, 0x00},
  {0x106B, "pto.tsync", 0, 0x00, 0x02, 0, 0, 0, 0x00},
  {0x106C, "pto.ttrans", 0, 0x00, 0x00, 2, 0, 0, 0x00},
  {0x106D, "pto.ttri", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x106E, "pto.txor", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x106F, "pto.txors", 0, 0x00, 0x00, 3, 0, 0, 0x00},
  {0x1070, "pto.wait_event", 0, 0x00, 0x00, 0, 0, 0, 0x02},
  {0x2000, "arith.addi", 0, 0x01, 0x00, 2, 1, 0, 0x00},
  {0x2001, "arith.ceildivsi", 0, 0x01, 0x00, 2, 1, 0, 0x00},
  {0x2002, "arith.cmpi", 0, 0x01, 0x00, 2, 1, 0, 0x01},
  {0x2003, "arith.constant", 0, 0x01, 0x00, 0, 1, 0, 0x05},
  {0x2004, "arith.index_cast", 0, 0x01, 0x00, 1, 1, 0, 0x00},
  {0x2005, "arith.minui", 0, 0x01, 0x00, 2, 1, 0, 0x00},
  {0x2006, "arith.muli", 0, 0x01, 0x00, 2, 1, 0, 0x00},
  {0x2007, "arith.select", 0, 0x01, 0x00, 3, 1, 0, 0x00},
  {0x2008, "arith.subi", 0, 0x01, 0x00, 2, 1, 0, 0x00},
  {0x4000, "scf.for", 0, 0x00, 0x00, 3, 0, 1, 0x00},
  {0x4001, "scf.if", 0, 0x00, 0x00, 1, 0, 2, 0x00},
  {0x4002, "scf.yield", 0, 0x00, 0x02, 0, 0, 0, 0x00},
  {0x6000, "func.func", 0, 0x00, 0x00, 0, 0, 0, 0x00},
  {0x6001, "func.return", 0, 0x00, 0x00, 0, 0, 0, 0x00},
};

inline const OpInfo *lookupByOpcode(uint16_t opcode) {
  // Binary search on kOpTable (sorted by opcode).
  size_t lo = 0, hi = sizeof(kOpTable) / sizeof(kOpTable[0]);
  while (lo < hi) {
    size_t mid = lo + (hi - lo) / 2;
    uint16_t v = kOpTable[mid].opcode;
    if (v == opcode) return &kOpTable[mid];
    if (v < opcode) lo = mid + 1; else hi = mid;
  }
  return nullptr;
}

inline std::optional<uint16_t> lookupOpcodeByName(llvm::StringRef name) {
  uint16_t v = llvm::StringSwitch<uint16_t>(name)
    .Case("arith.addi", 0x2000)
    .Case("arith.ceildivsi", 0x2001)
    .Case("arith.cmpi", 0x2002)
    .Case("arith.constant", 0x2003)
    .Case("arith.index_cast", 0x2004)
    .Case("arith.minui", 0x2005)
    .Case("arith.muli", 0x2006)
    .Case("arith.select", 0x2007)
    .Case("arith.subi", 0x2008)
    .Case("func.func", 0x6000)
    .Case("func.return", 0x6001)
    .Case("pto.addptr", 0x1000)
    .Case("pto.alloc_tile", 0x1001)
    .Case("pto.barrier", 0x1002)
    .Case("pto.get_block_idx", 0x0000)
    .Case("pto.get_block_num", 0x0001)
    .Case("pto.get_subblock_idx", 0x0002)
    .Case("pto.get_subblock_num", 0x0003)
    .Case("pto.make_tensor_view", 0x0004)
    .Case("pto.mgather", 0x1003)
    .Case("pto.mscatter", 0x1004)
    .Case("pto.partition_view", 0x0005)
    .Case("pto.record_event", 0x1005)
    .Case("pto.section", 0x0006)
    .Case("pto.tabs", 0x1006)
    .Case("pto.tadd", 0x1007)
    .Case("pto.taddc", 0x1008)
    .Case("pto.tadds", 0x1009)
    .Case("pto.taddsc", 0x100A)
    .Case("pto.tand", 0x100B)
    .Case("pto.tands", 0x100C)
    .Case("pto.tci", 0x100D)
    .Case("pto.tcmp", 0x100E)
    .Case("pto.tcmps", 0x100F)
    .Case("pto.tcolexpand", 0x1010)
    .Case("pto.tcolexpandadd", 0x1011)
    .Case("pto.tcolexpanddiv", 0x1012)
    .Case("pto.tcolexpandexpdif", 0x1013)
    .Case("pto.tcolexpandmax", 0x1014)
    .Case("pto.tcolexpandmin", 0x1015)
    .Case("pto.tcolexpandmul", 0x1016)
    .Case("pto.tcolexpandsub", 0x1017)
    .Case("pto.tcolmax", 0x1018)
    .Case("pto.tcolmin", 0x1019)
    .Case("pto.tcolprod", 0x101A)
    .Case("pto.tcolsum", 0x101B)
    .Case("pto.tcvt", 0x101C)
    .Case("pto.tdiv", 0x101D)
    .Case("pto.tdivs", 0x101E)
    .Case("pto.texp", 0x101F)
    .Case("pto.texpands", 0x1020)
    .Case("pto.textract", 0x1021)
    .Case("pto.textract_fp", 0x1022)
    .Case("pto.tfillpad", 0x1023)
    .Case("pto.tfillpad_expand", 0x1024)
    .Case("pto.tfillpad_inplace", 0x1025)
    .Case("pto.tfmod", 0x1026)
    .Case("pto.tfmods", 0x1027)
    .Case("pto.tgather", 0x1028)
    .Case("pto.tgatherb", 0x1029)
    .Case("pto.tgemv", 0x102A)
    .Case("pto.tgetval", 0x102B)
    .Case("pto.timg2col", 0x102C)
    .Case("pto.tinsert", 0x102D)
    .Case("pto.tinsert_fp", 0x102E)
    .Case("pto.tload", 0x102F)
    .Case("pto.tlog", 0x1030)
    .Case("pto.tlrelu", 0x1031)
    .Case("pto.tmatmul", 0x1032)
    .Case("pto.tmatmul.mx", 0x1033)
    .Case("pto.tmax", 0x1034)
    .Case("pto.tmaxs", 0x1035)
    .Case("pto.tmin", 0x1036)
    .Case("pto.tmins", 0x1037)
    .Case("pto.tmov", 0x1038)
    .Case("pto.tmov.fp", 0x1039)
    .Case("pto.tmrgsort", 0x103A)
    .Case("pto.tmul", 0x103B)
    .Case("pto.tmuls", 0x103C)
    .Case("pto.tneg", 0x103D)
    .Case("pto.tnot", 0x103E)
    .Case("pto.tor", 0x103F)
    .Case("pto.tors", 0x1040)
    .Case("pto.tpartadd", 0x1041)
    .Case("pto.tpartmax", 0x1042)
    .Case("pto.tpartmin", 0x1043)
    .Case("pto.tpartmul", 0x1044)
    .Case("pto.tprefetch", 0x1045)
    .Case("pto.tprelu", 0x1046)
    .Case("pto.tquant", 0x1047)
    .Case("pto.trecip", 0x1048)
    .Case("pto.trelu", 0x1049)
    .Case("pto.trem", 0x104A)
    .Case("pto.trems", 0x104B)
    .Case("pto.treshape", 0x104C)
    .Case("pto.trowexpand", 0x104D)
    .Case("pto.trowexpandadd", 0x104E)
    .Case("pto.trowexpandexpdif", 0x104F)
    .Case("pto.trowexpandmax", 0x1050)
    .Case("pto.trowexpandmin", 0x1051)
    .Case("pto.trowmax", 0x1052)
    .Case("pto.trowmin", 0x1053)
    .Case("pto.trowsum", 0x1054)
    .Case("pto.trsqrt", 0x1055)
    .Case("pto.tscatter", 0x1056)
    .Case("pto.tsel", 0x1057)
    .Case("pto.tsels", 0x1058)
    .Case("pto.tset_img2col_padding", 0x1059)
    .Case("pto.tset_img2col_rpt", 0x105A)
    .Case("pto.tsetfmatrix", 0x105B)
    .Case("pto.tsethf32mode", 0x105C)
    .Case("pto.tsettf32mode", 0x105D)
    .Case("pto.tsetval", 0x105E)
    .Case("pto.tshl", 0x105F)
    .Case("pto.tshls", 0x1060)
    .Case("pto.tshr", 0x1061)
    .Case("pto.tshrs", 0x1062)
    .Case("pto.tsort32", 0x1063)
    .Case("pto.tsqrt", 0x1064)
    .Case("pto.tstore", 0x1065)
    .Case("pto.tstore.fp", 0x1066)
    .Case("pto.tsub", 0x1067)
    .Case("pto.tsubc", 0x1068)
    .Case("pto.tsubs", 0x1069)
    .Case("pto.tsubsc", 0x106A)
    .Case("pto.tsync", 0x106B)
    .Case("pto.ttrans", 0x106C)
    .Case("pto.ttri", 0x106D)
    .Case("pto.txor", 0x106E)
    .Case("pto.txors", 0x106F)
    .Case("pto.wait_event", 0x1070)
    .Case("scf.for", 0x4000)
    .Case("scf.if", 0x4001)
    .Case("scf.yield", 0x4002)
    .Default(0xFFFF);
  if (v == 0xFFFF) return std::nullopt;
  return v;
}

inline const OpInfo *lookupByName(llvm::StringRef name) {
  auto o = lookupOpcodeByName(name);
  if (!o) return nullptr;
  return lookupByOpcode(*o);
}

struct OpcodeAndVariant { uint16_t opcode; uint8_t hasVariant; uint8_t variant; };

inline std::optional<OpcodeAndVariant> lookupOpcodeAndVariantByFullName(llvm::StringRef fullName) {
  // For non-family ops, variant is 0. For family ops, variant is the assigned u8.
  // NOTE: `pto.section` is not a real op name; use `pto.section.cube`/`pto.section.vector`.
  return llvm::StringSwitch<std::optional<OpcodeAndVariant>>(fullName)
    .Case("arith.addi", OpcodeAndVariant{0x2000, 0, 0})
    .Case("arith.ceildivsi", OpcodeAndVariant{0x2001, 0, 0})
    .Case("arith.cmpi", OpcodeAndVariant{0x2002, 0, 0})
    .Case("arith.constant", OpcodeAndVariant{0x2003, 0, 0})
    .Case("arith.index_cast", OpcodeAndVariant{0x2004, 0, 0})
    .Case("arith.minui", OpcodeAndVariant{0x2005, 0, 0})
    .Case("arith.muli", OpcodeAndVariant{0x2006, 0, 0})
    .Case("arith.select", OpcodeAndVariant{0x2007, 0, 0})
    .Case("arith.subi", OpcodeAndVariant{0x2008, 0, 0})
    .Case("func.func", OpcodeAndVariant{0x6000, 0, 0})
    .Case("func.return", OpcodeAndVariant{0x6001, 0, 0})
    .Case("pto.addptr", OpcodeAndVariant{0x1000, 0, 0})
    .Case("pto.alloc_tile", OpcodeAndVariant{0x1001, 0, 0})
    .Case("pto.barrier", OpcodeAndVariant{0x1002, 0, 0})
    .Case("pto.get_block_idx", OpcodeAndVariant{0x0000, 0, 0})
    .Case("pto.get_block_num", OpcodeAndVariant{0x0001, 0, 0})
    .Case("pto.get_subblock_idx", OpcodeAndVariant{0x0002, 0, 0})
    .Case("pto.get_subblock_num", OpcodeAndVariant{0x0003, 0, 0})
    .Case("pto.make_tensor_view", OpcodeAndVariant{0x0004, 0, 0})
    .Case("pto.mgather", OpcodeAndVariant{0x1003, 0, 0})
    .Case("pto.mscatter", OpcodeAndVariant{0x1004, 0, 0})
    .Case("pto.partition_view", OpcodeAndVariant{0x0005, 0, 0})
    .Case("pto.record_event", OpcodeAndVariant{0x1005, 0, 0})
    .Case("pto.tabs", OpcodeAndVariant{0x1006, 0, 0})
    .Case("pto.tadd", OpcodeAndVariant{0x1007, 0, 0})
    .Case("pto.taddc", OpcodeAndVariant{0x1008, 0, 0})
    .Case("pto.tadds", OpcodeAndVariant{0x1009, 0, 0})
    .Case("pto.taddsc", OpcodeAndVariant{0x100A, 0, 0})
    .Case("pto.tand", OpcodeAndVariant{0x100B, 0, 0})
    .Case("pto.tands", OpcodeAndVariant{0x100C, 0, 0})
    .Case("pto.tci", OpcodeAndVariant{0x100D, 0, 0})
    .Case("pto.tcmp", OpcodeAndVariant{0x100E, 0, 0})
    .Case("pto.tcmps", OpcodeAndVariant{0x100F, 0, 0})
    .Case("pto.tcolexpand", OpcodeAndVariant{0x1010, 0, 0})
    .Case("pto.tcolexpandadd", OpcodeAndVariant{0x1011, 0, 0})
    .Case("pto.tcolexpanddiv", OpcodeAndVariant{0x1012, 0, 0})
    .Case("pto.tcolexpandexpdif", OpcodeAndVariant{0x1013, 0, 0})
    .Case("pto.tcolexpandmax", OpcodeAndVariant{0x1014, 0, 0})
    .Case("pto.tcolexpandmin", OpcodeAndVariant{0x1015, 0, 0})
    .Case("pto.tcolexpandmul", OpcodeAndVariant{0x1016, 0, 0})
    .Case("pto.tcolexpandsub", OpcodeAndVariant{0x1017, 0, 0})
    .Case("pto.tcolmax", OpcodeAndVariant{0x1018, 0, 0})
    .Case("pto.tcolmin", OpcodeAndVariant{0x1019, 0, 0})
    .Case("pto.tcolprod", OpcodeAndVariant{0x101A, 0, 0})
    .Case("pto.tcolsum", OpcodeAndVariant{0x101B, 0, 0})
    .Case("pto.tcvt", OpcodeAndVariant{0x101C, 0, 0})
    .Case("pto.tdiv", OpcodeAndVariant{0x101D, 0, 0})
    .Case("pto.tdivs", OpcodeAndVariant{0x101E, 0, 0})
    .Case("pto.texp", OpcodeAndVariant{0x101F, 0, 0})
    .Case("pto.texpands", OpcodeAndVariant{0x1020, 0, 0})
    .Case("pto.textract", OpcodeAndVariant{0x1021, 0, 0})
    .Case("pto.textract_fp", OpcodeAndVariant{0x1022, 0, 0})
    .Case("pto.tfillpad", OpcodeAndVariant{0x1023, 0, 0})
    .Case("pto.tfillpad_expand", OpcodeAndVariant{0x1024, 0, 0})
    .Case("pto.tfillpad_inplace", OpcodeAndVariant{0x1025, 0, 0})
    .Case("pto.tfmod", OpcodeAndVariant{0x1026, 0, 0})
    .Case("pto.tfmods", OpcodeAndVariant{0x1027, 0, 0})
    .Case("pto.tgather", OpcodeAndVariant{0x1028, 0, 0})
    .Case("pto.tgatherb", OpcodeAndVariant{0x1029, 0, 0})
    .Case("pto.tgetval", OpcodeAndVariant{0x102B, 0, 0})
    .Case("pto.timg2col", OpcodeAndVariant{0x102C, 0, 0})
    .Case("pto.tinsert", OpcodeAndVariant{0x102D, 0, 0})
    .Case("pto.tinsert_fp", OpcodeAndVariant{0x102E, 0, 0})
    .Case("pto.tload", OpcodeAndVariant{0x102F, 0, 0})
    .Case("pto.tlog", OpcodeAndVariant{0x1030, 0, 0})
    .Case("pto.tlrelu", OpcodeAndVariant{0x1031, 0, 0})
    .Case("pto.tmax", OpcodeAndVariant{0x1034, 0, 0})
    .Case("pto.tmaxs", OpcodeAndVariant{0x1035, 0, 0})
    .Case("pto.tmin", OpcodeAndVariant{0x1036, 0, 0})
    .Case("pto.tmins", OpcodeAndVariant{0x1037, 0, 0})
    .Case("pto.tmov", OpcodeAndVariant{0x1038, 0, 0})
    .Case("pto.tmov.fp", OpcodeAndVariant{0x1039, 0, 0})
    .Case("pto.tmrgsort", OpcodeAndVariant{0x103A, 0, 0})
    .Case("pto.tmul", OpcodeAndVariant{0x103B, 0, 0})
    .Case("pto.tmuls", OpcodeAndVariant{0x103C, 0, 0})
    .Case("pto.tneg", OpcodeAndVariant{0x103D, 0, 0})
    .Case("pto.tnot", OpcodeAndVariant{0x103E, 0, 0})
    .Case("pto.tor", OpcodeAndVariant{0x103F, 0, 0})
    .Case("pto.tors", OpcodeAndVariant{0x1040, 0, 0})
    .Case("pto.tpartadd", OpcodeAndVariant{0x1041, 0, 0})
    .Case("pto.tpartmax", OpcodeAndVariant{0x1042, 0, 0})
    .Case("pto.tpartmin", OpcodeAndVariant{0x1043, 0, 0})
    .Case("pto.tpartmul", OpcodeAndVariant{0x1044, 0, 0})
    .Case("pto.tprefetch", OpcodeAndVariant{0x1045, 0, 0})
    .Case("pto.tprelu", OpcodeAndVariant{0x1046, 0, 0})
    .Case("pto.tquant", OpcodeAndVariant{0x1047, 0, 0})
    .Case("pto.trecip", OpcodeAndVariant{0x1048, 0, 0})
    .Case("pto.trelu", OpcodeAndVariant{0x1049, 0, 0})
    .Case("pto.trem", OpcodeAndVariant{0x104A, 0, 0})
    .Case("pto.trems", OpcodeAndVariant{0x104B, 0, 0})
    .Case("pto.treshape", OpcodeAndVariant{0x104C, 0, 0})
    .Case("pto.trowexpand", OpcodeAndVariant{0x104D, 0, 0})
    .Case("pto.trowexpandadd", OpcodeAndVariant{0x104E, 0, 0})
    .Case("pto.trowexpandexpdif", OpcodeAndVariant{0x104F, 0, 0})
    .Case("pto.trowexpandmax", OpcodeAndVariant{0x1050, 0, 0})
    .Case("pto.trowexpandmin", OpcodeAndVariant{0x1051, 0, 0})
    .Case("pto.trowmax", OpcodeAndVariant{0x1052, 0, 0})
    .Case("pto.trowmin", OpcodeAndVariant{0x1053, 0, 0})
    .Case("pto.trowsum", OpcodeAndVariant{0x1054, 0, 0})
    .Case("pto.trsqrt", OpcodeAndVariant{0x1055, 0, 0})
    .Case("pto.tscatter", OpcodeAndVariant{0x1056, 0, 0})
    .Case("pto.tsel", OpcodeAndVariant{0x1057, 0, 0})
    .Case("pto.tsels", OpcodeAndVariant{0x1058, 0, 0})
    .Case("pto.tset_img2col_padding", OpcodeAndVariant{0x1059, 0, 0})
    .Case("pto.tset_img2col_rpt", OpcodeAndVariant{0x105A, 0, 0})
    .Case("pto.tsetfmatrix", OpcodeAndVariant{0x105B, 0, 0})
    .Case("pto.tsethf32mode", OpcodeAndVariant{0x105C, 0, 0})
    .Case("pto.tsettf32mode", OpcodeAndVariant{0x105D, 0, 0})
    .Case("pto.tsetval", OpcodeAndVariant{0x105E, 0, 0})
    .Case("pto.tshl", OpcodeAndVariant{0x105F, 0, 0})
    .Case("pto.tshls", OpcodeAndVariant{0x1060, 0, 0})
    .Case("pto.tshr", OpcodeAndVariant{0x1061, 0, 0})
    .Case("pto.tshrs", OpcodeAndVariant{0x1062, 0, 0})
    .Case("pto.tsort32", OpcodeAndVariant{0x1063, 0, 0})
    .Case("pto.tsqrt", OpcodeAndVariant{0x1064, 0, 0})
    .Case("pto.tstore", OpcodeAndVariant{0x1065, 0, 0})
    .Case("pto.tstore.fp", OpcodeAndVariant{0x1066, 0, 0})
    .Case("pto.tsub", OpcodeAndVariant{0x1067, 0, 0})
    .Case("pto.tsubc", OpcodeAndVariant{0x1068, 0, 0})
    .Case("pto.tsubs", OpcodeAndVariant{0x1069, 0, 0})
    .Case("pto.tsubsc", OpcodeAndVariant{0x106A, 0, 0})
    .Case("pto.tsync", OpcodeAndVariant{0x106B, 0, 0})
    .Case("pto.ttrans", OpcodeAndVariant{0x106C, 0, 0})
    .Case("pto.ttri", OpcodeAndVariant{0x106D, 0, 0})
    .Case("pto.txor", OpcodeAndVariant{0x106E, 0, 0})
    .Case("pto.txors", OpcodeAndVariant{0x106F, 0, 0})
    .Case("pto.wait_event", OpcodeAndVariant{0x1070, 0, 0})
    .Case("scf.for", OpcodeAndVariant{0x4000, 0, 0})
    .Case("scf.if", OpcodeAndVariant{0x4001, 0, 0})
    .Case("scf.yield", OpcodeAndVariant{0x4002, 0, 0})
    .Case("pto.section.cube", OpcodeAndVariant{0x0006, 1, 0})
    .Case("pto.section.vector", OpcodeAndVariant{0x0006, 1, 1})
    .Case("pto.tgemv", OpcodeAndVariant{0x102A, 1, 0})
    .Case("pto.tgemv.acc", OpcodeAndVariant{0x102A, 1, 1})
    .Case("pto.tgemv.bias", OpcodeAndVariant{0x102A, 1, 2})
    .Case("pto.tgemv.mx", OpcodeAndVariant{0x102A, 1, 3})
    .Case("pto.tmatmul", OpcodeAndVariant{0x1032, 1, 0})
    .Case("pto.tmatmul.acc", OpcodeAndVariant{0x1032, 1, 1})
    .Case("pto.tmatmul.bias", OpcodeAndVariant{0x1032, 1, 2})
    .Case("pto.tmatmul.mx", OpcodeAndVariant{0x1033, 1, 0})
    .Case("pto.tmatmul.mx.acc", OpcodeAndVariant{0x1033, 1, 1})
    .Case("pto.tmatmul.mx.bias", OpcodeAndVariant{0x1033, 1, 2})
    .Default(std::nullopt);
}

inline const char *fullNameFromOpcodeVariant(uint16_t opcode, uint8_t variant) {
  const OpInfo *info = lookupByOpcode(opcode);
  if (!info) return nullptr;
  if (!info->has_variant_u8) return info->name;
  switch (opcode) {
  case 0x0006:
    switch (variant) {
    case 0: return "pto.section.cube";
    case 1: return "pto.section.vector";
    default: return info->name;
    }
  case 0x102A:
    switch (variant) {
    case 0: return "pto.tgemv";
    case 1: return "pto.tgemv.acc";
    case 2: return "pto.tgemv.bias";
    case 3: return "pto.tgemv.mx";
    default: return info->name;
    }
  case 0x1032:
    switch (variant) {
    case 0: return "pto.tmatmul";
    case 1: return "pto.tmatmul.acc";
    case 2: return "pto.tmatmul.bias";
    default: return info->name;
    }
  case 0x1033:
    switch (variant) {
    case 0: return "pto.tmatmul.mx";
    case 1: return "pto.tmatmul.mx.acc";
    case 2: return "pto.tmatmul.mx.bias";
    default: return info->name;
    }
  default: return info->name;
  }
}

inline std::optional<int> lookupOperandsByVariant(uint16_t opcode, uint8_t variant) {
  switch (opcode) {
  case 0x102A:
    switch (variant) {
    case 0: return 3;
    case 1: return 4;
    case 2: return 4;
    case 3: return 5;
    default: return std::nullopt;
    }
  case 0x1032:
    switch (variant) {
    case 0: return 3;
    case 1: return 4;
    case 2: return 4;
    default: return std::nullopt;
    }
  case 0x1033:
    switch (variant) {
    case 0: return 5;
    case 1: return 6;
    case 2: return 6;
    default: return std::nullopt;
    }
  default: return std::nullopt;
  }
}

// Variant maps (label -> variant_u8), mirrored from the Sail generator:
// {"pto.section": {"cube": 0, "vector": 1}, "pto.tgemv": {"acc": 1, "base": 0, "bias": 2, "mx": 3}, "pto.tmatmul": {"acc": 1, "base": 0, "bias": 2}, "pto.tmatmul.mx": {"acc": 1, "base": 0, "bias": 2}}

} // namespace ptobc::v0
